# 多用户在线编辑功能测试指南

## 🎯 测试目标

验证系统支持多个用户同时在线编辑同一个文档，实时同步内容变更，实现真正的多用户协作功能。

## 📋 测试准备

### 1. 启动应用
确保Spring Boot应用在8080端口运行：
```bash
.\mvnw.cmd spring-boot:run
```

### 2. 准备测试用户
需要创建至少2个测试用户账号：

#### 创建测试用户：
1. 访问 `http://localhost:8080/multi-user-test.html`
2. 点击"注册"按钮创建用户：
   - 用户A: `testuser1` / `123456`
   - 用户B: `testuser2` / `123456`
   - 用户C: `testuser3` / `123456` (可选)

### 3. 测试环境配置
- **浏览器**: Chrome/Edge/Firefox (建议使用多个浏览器窗口)
- **网络**: 确保网络连接稳定
- **权限**: 测试用户需要有文档编辑权限

## 🚀 测试流程

### 第一阶段：单用户测试

#### 步骤1：用户登录
1. 打开 `http://localhost:8080/multi-user-test.html`
2. 点击"登录"，输入测试账号
3. 选择文档ID (例如：1)
4. 连接到文档

#### 步骤2：基础功能测试
1. **连接测试**：
   - 观察连接状态变为"已连接"
   - 日志显示"WebSocket连接成功"
   - 在线用户数量更新

2. **编辑测试**：
   - 在编辑器中输入文本
   - 观察操作日志记录编辑操作
   - 内容变化正常显示

3. **模拟输入测试**：
   - 点击"模拟输入"按钮
   - 观察内容自动添加和同步

### 第二阶段：多用户协作测试

#### 步骤1：开启多个会话
1. **浏览器窗口1**: 用户A登录，连接文档ID 1
2. **浏览器窗口2**: 用户B登录，连接文档ID 1
3. **浏览器窗口3**: 用户C登录，连接文档ID 1 (可选)

#### 步骤2：实时协作测试

##### 测试场景1：同时输入
1. 用户A在文档开头输入："用户A的输入"
2. 用户B在文档中间输入："用户B的输入"
3. 用户C在文档结尾输入："用户C的输入"
4. **预期结果**：
   - 所有用户的编辑器内容实时同步
   - 操作日志显示所有用户的操作
   - 在线用户列表显示所有协作用户

##### 测试场景2：交叉编辑
1. 用户A选中一段文本
2. 用户B在用户A选中的文本中进行编辑
3. **预期结果**：
   - OT算法正确处理并发操作
   - 所有用户看到一致的内容状态
   - 无内容冲突或丢失

##### 测试场景3：用户状态同步
1. 用户A加入文档
2. 用户B观察用户列表变化
3. 用户A离开文档
4. **预期结果**：
   - 用户加入/离开实时通知
   - 在线用户计数正确更新
   - 用户状态指示器正常工作

##### 测试场景4：网络断开恢复
1. 断开某个用户的网络连接（或关闭浏览器窗口）
2. 重新连接到相同文档
3. **预期结果**：
   - 用户状态正确更新
   - 重新连接后能看到最新内容
   - 协作继续正常进行

## 📊 功能验证清单

### ✅ WebSocket连接功能
- [ ] SockJS连接建立成功
- [ ] STOMP协议握手正常
- [ ] 频道订阅成功
- [ ] 连接状态实时更新

### ✅ 用户管理功能
- [ ] 用户登录/注册正常
- [ ] 用户状态同步
- [ ] 在线用户列表更新
- [ ] 用户权限验证

### ✅ 实时协作功能
- [ ] 多用户同时编辑
- [ ] 内容实时同步
- [ ] 操作冲突解决 (OT算法)
- [ ] 编辑光标位置同步

### ✅ 文档操作功能
- [ ] 文本插入操作
- [ ] 文本删除操作
- [ ] 格式化操作
- [ ] 撤销/重做操作

### ✅ 系统稳定性
- [ ] 网络断开自动重连
- [ ] 异常情况处理
- [ ] 性能表现良好
- [ ] 内存泄漏检查

## 🛠️ 测试工具

### 1. 多用户测试页面
```
http://localhost:8080/multi-user-test.html
```
- 完整的协作测试界面
- 实时操作日志
- 用户状态监控
- 连接状态指示

### 2. 快速测试套件
```
http://localhost:8080/quick-test.html
```
- 自动化功能测试
- WebSocket连接验证
- API接口测试

### 3. 库加载诊断
```
http://localhost:8080/lib-test.html
```
- SockJS/STOMP库状态检查
- 加载问题诊断

## 🔍 故障排除

### 常见问题

#### 1. WebSocket连接失败
**现象**: "WebSocket连接失败"错误
**解决**:
- 检查应用是否在8080端口运行
- 确认防火墙未阻止WebSocket连接
- 查看浏览器控制台错误信息

#### 2. 库加载失败
**现象**: "SockJS is not defined" 或 "Stomp is not defined"
**解决**:
- 访问 `http://localhost:8080/lib-test.html` 检查库状态
- 刷新页面重新加载库
- 检查网络连接

#### 3. 内容不同步
**现象**: 用户间的编辑内容不一致
**解决**:
- 检查OT算法实现是否正确
- 确认WebSocket消息正常传输
- 查看操作日志确认消息接收

#### 4. 用户状态不更新
**现象**: 在线用户列表不更新
**解决**:
- 检查用户加入/离开消息发送
- 确认WebSocket频道订阅正常
- 验证用户权限设置

### 调试技巧

1. **打开浏览器开发者工具** (F12)
2. **查看Console标签页**: WebSocket连接日志
3. **查看Network标签页**: WebSocket连接状态
4. **使用测试页面日志**: 详细的操作记录

## 📈 性能测试

### 并发用户测试
- 同时开启5-10个浏览器窗口
- 每个窗口连接同一个文档
- 进行密集编辑操作
- 监控系统响应时间

### 网络延迟测试
- 使用浏览器开发者工具模拟网络延迟
- 测试在高延迟环境下的协作效果
- 验证OT算法在延迟环境下的正确性

## 🎯 测试完成标准

### ✅ 功能完整性
- [ ] 所有基础功能正常工作
- [ ] 多用户协作功能完整实现
- [ ] OT算法正确处理并发操作
- [ ] WebSocket连接稳定可靠

### ✅ 用户体验
- [ ] 编辑响应及时 (<100ms)
- [ ] 内容同步流畅
- [ ] 用户状态更新及时
- [ ] 界面友好易用

### ✅ 系统稳定性
- [ ] 无内存泄漏
- [ ] 异常情况正确处理
- [ ] 高并发场景稳定
- [ ] 网络波动自动恢复

## 🚀 开始测试

1. **启动应用**: 确保Spring Boot应用运行
2. **创建用户**: 注册至少2个测试用户
3. **打开测试页面**: `http://localhost:8080/multi-user-test.html`
4. **开始协作**: 多个用户同时编辑同一文档
5. **验证功能**: 按照上述测试场景进行验证

**祝测试顺利！🎉**
